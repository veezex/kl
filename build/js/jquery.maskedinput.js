!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?e(require("jquery")):e(jQuery)}(function(R){var a,e=navigator.userAgent,S=/iphone/i.test(e),i=/chrome/i.test(e),T=/android/i.test(e);R.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},autoclear:!0,dataName:"rawMaskFn",placeholder:"_"},R.fn.extend({caret:function(e,t){var n;if(0!==this.length&&!this.is(":hidden")&&this.get(0)===document.activeElement)return"number"==typeof e?(t="number"==typeof t?t:e,this.each(function(){this.setSelectionRange?this.setSelectionRange(e,t):this.createTextRange&&((n=this.createTextRange()).collapse(!0),n.moveEnd("character",t),n.moveStart("character",e),n.select())})):(this[0].setSelectionRange?(e=this[0].selectionStart,t=this[0].selectionEnd):document.selection&&document.selection.createRange&&(n=document.selection.createRange(),e=0-n.duplicate().moveStart("character",-1e5),t=e+n.text.length),{begin:e,end:t})},unmask:function(){return this.trigger("unmask")},mask:function(t,v){var n,b,k,y,x,j,A;if(!t&&0<this.length){var e=R(this[0]).data(R.mask.dataName);return e?e():void 0}return v=R.extend({autoclear:R.mask.autoclear,placeholder:R.mask.placeholder,completed:null},v),n=R.mask.definitions,b=[],k=j=t.length,y=null,t=String(t),R.each(t.split(""),function(e,t){"?"==t?(j--,k=e):n[t]?(b.push(new RegExp(n[t])),null===y&&(y=b.length-1),e<k&&(x=b.length-1)):b.push(null)}),this.trigger("unmask").each(function(){var o=R(this),c=R.map(t.split(""),function(e,t){if("?"!=e)return n[e]?f(t):e}),l=c.join(""),r=o.val();function u(){if(v.completed){for(var e=y;e<=x;e++)if(b[e]&&c[e]===f(e))return;v.completed.call(o)}}function f(e){return e<v.placeholder.length?v.placeholder.charAt(e):v.placeholder.charAt(0)}function s(e){for(;++e<j&&!b[e];);return e}function h(e,t){var n,a;if(!(e<0)){for(n=e,a=s(t);n<j;n++)if(b[n]){if(!(a<j&&b[n].test(c[a])))break;c[n]=c[a],c[a]=f(a),a=s(a)}d(),o.caret(Math.max(y,e))}}function g(e){p(),o.val()!=r&&o.change()}function m(e,t){var n;for(n=e;n<t&&n<j;n++)b[n]&&(c[n]=f(n))}function d(){o.val(c.join(""))}function p(e){var t,n,a,i=o.val(),r=-1;for(a=t=0;t<j;t++)if(b[t]){for(c[t]=f(t);a++<i.length;)if(n=i.charAt(a-1),b[t].test(n)){c[t]=n,r=t;break}if(a>i.length){m(t+1,j);break}}else c[t]===i.charAt(a)&&a++,t<k&&(r=t);return e?d():r+1<k?v.autoclear||c.join("")===l?(o.val()&&o.val(""),m(0,j)):d():(d(),o.val(o.val().substring(0,r+1))),k?t:y}o.data(R.mask.dataName,function(){return R.map(c,function(e,t){return b[t]&&e!=f(t)?e:null}).join("")}),o.one("unmask",function(){o.off(".mask").removeData(R.mask.dataName)}).on("focus.mask",function(){var e;o.prop("readonly")||(clearTimeout(a),r=o.val(),e=p(),a=setTimeout(function(){o.get(0)===document.activeElement&&(d(),e==t.replace("?","").length?o.caret(0,e):o.caret(e))},10))}).on("blur.mask",g).on("keydown.mask",function(e){if(!o.prop("readonly")){var t,n,a,i=e.which||e.keyCode;A=o.val(),8===i||46===i||S&&127===i?(n=(t=o.caret()).begin,(a=t.end)-n==0&&(n=46!==i?function(e){for(;0<=--e&&!b[e];);return e}(n):a=s(n-1),a=46===i?s(a):a),m(n,a),h(n,a-1),e.preventDefault()):13===i?g.call(this,e):27===i&&(o.val(r),o.caret(0,p()),e.preventDefault())}}).on("keypress.mask",function(e){if(!o.prop("readonly")){var t,n,a,i=e.which||e.keyCode,r=o.caret();e.ctrlKey||e.altKey||e.metaKey||i<32||!i||13===i||(r.end-r.begin!=0&&(m(r.begin,r.end),h(r.begin,r.end-1)),(t=s(r.begin-1))<j&&(n=String.fromCharCode(i),b[t].test(n))&&(function(e){var t,n,a,i;for(n=f(t=e);t<j;t++)if(b[t]){if(a=s(t),i=c[t],c[t]=n,!(a<j&&b[a].test(i)))break;n=i}}(t),c[t]=n,d(),a=s(t),T?setTimeout(function(){R.proxy(R.fn.caret,o,a)()},0):o.caret(a),r.begin<=x&&u()),e.preventDefault())}}).on("input.mask paste.mask",function(){o.prop("readonly")||setTimeout(function(){var e=p(!0);o.caret(e),u()},0)}),i&&T&&o.off("input.mask").on("input.mask",function(e){var t=o.val(),n=o.caret();if(A&&A.length&&A.length>t.length){for(p(!0);0<n.begin&&!b[n.begin-1];)n.begin--;if(0===n.begin)for(;n.begin<y&&!b[n.begin];)n.begin++;o.caret(n.begin,n.begin)}else{p(!0);var a=t.charAt(n.begin);n.begin<j&&(b[n.begin]||n.begin++,b[n.begin].test(a)&&n.begin++),o.caret(n.begin,n.begin)}u()}),p()})}})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpxdWVyeS5tYXNrZWRpbnB1dC5qcyJdLCJuYW1lcyI6WyJmYWN0b3J5IiwiZGVmaW5lIiwiYW1kIiwiZXhwb3J0cyIsInJlcXVpcmUiLCJqUXVlcnkiLCIkIiwiY2FyZXRUaW1lb3V0SWQiLCJ1YSIsIm5hdmlnYXRvciIsInVzZXJBZ2VudCIsImlQaG9uZSIsInRlc3QiLCJjaHJvbWUiLCJhbmRyb2lkIiwibWFzayIsImRlZmluaXRpb25zIiwiOSIsImEiLCIqIiwiYXV0b2NsZWFyIiwiZGF0YU5hbWUiLCJwbGFjZWhvbGRlciIsImZuIiwiZXh0ZW5kIiwiY2FyZXQiLCJiZWdpbiIsImVuZCIsInJhbmdlIiwidGhpcyIsImxlbmd0aCIsImlzIiwiZ2V0IiwiZG9jdW1lbnQiLCJhY3RpdmVFbGVtZW50IiwiZWFjaCIsInNldFNlbGVjdGlvblJhbmdlIiwiY3JlYXRlVGV4dFJhbmdlIiwiY29sbGFwc2UiLCJtb3ZlRW5kIiwibW92ZVN0YXJ0Iiwic2VsZWN0Iiwic2VsZWN0aW9uU3RhcnQiLCJzZWxlY3Rpb25FbmQiLCJzZWxlY3Rpb24iLCJjcmVhdGVSYW5nZSIsImR1cGxpY2F0ZSIsInRleHQiLCJ1bm1hc2siLCJ0cmlnZ2VyIiwic2V0dGluZ3MiLCJkZWZzIiwidGVzdHMiLCJwYXJ0aWFsUG9zaXRpb24iLCJmaXJzdE5vbk1hc2tQb3MiLCJsYXN0UmVxdWlyZWROb25NYXNrUG9zIiwibGVuIiwib2xkVmFsIiwiZGF0YSIsInVuZGVmaW5lZCIsImNvbXBsZXRlZCIsIlN0cmluZyIsInNwbGl0IiwiaSIsImMiLCJwdXNoIiwiUmVnRXhwIiwiaW5wdXQiLCJidWZmZXIiLCJtYXAiLCJnZXRQbGFjZWhvbGRlciIsImRlZmF1bHRCdWZmZXIiLCJqb2luIiwiZm9jdXNUZXh0IiwidmFsIiwidHJ5RmlyZUNvbXBsZXRlZCIsImNhbGwiLCJjaGFyQXQiLCJzZWVrTmV4dCIsInBvcyIsInNoaWZ0TCIsImoiLCJ3cml0ZUJ1ZmZlciIsIk1hdGgiLCJtYXgiLCJibHVyRXZlbnQiLCJlIiwiY2hlY2tWYWwiLCJjaGFuZ2UiLCJjbGVhckJ1ZmZlciIsInN0YXJ0IiwiYWxsb3ciLCJsYXN0TWF0Y2giLCJzdWJzdHJpbmciLCJvbmUiLCJvZmYiLCJyZW1vdmVEYXRhIiwib24iLCJwcm9wIiwiY2xlYXJUaW1lb3V0Iiwic2V0VGltZW91dCIsInJlcGxhY2UiLCJrIiwid2hpY2giLCJrZXlDb2RlIiwic2Vla1ByZXYiLCJwcmV2ZW50RGVmYXVsdCIsInAiLCJuZXh0IiwiY3RybEtleSIsImFsdEtleSIsIm1ldGFLZXkiLCJmcm9tQ2hhckNvZGUiLCJ0Iiwic2hpZnRSIiwicHJveHkiLCJjdXJWYWwiLCJsYXN0RW50ZXJlZFZhbHVlIl0sIm1hcHBpbmdzIjoiQ0FBQyxTQUFVQSxHQUNlLG1CQUFYQyxRQUF5QkEsT0FBT0MsSUFFdkNELE9BQU8sQ0FBQyxVQUFXRCxHQUNPLGlCQUFaRyxRQUVkSCxFQUFRSSxRQUFRLFdBR2hCSixFQUFRSyxRQVRoQixDQVdFLFNBQVVDLEdBRVosSUFJQ0MsRUFKR0MsRUFBS0MsVUFBVUMsVUFDbEJDLEVBQVMsVUFBVUMsS0FBS0osR0FDeEJLLEVBQVMsVUFBVUQsS0FBS0osR0FDeEJNLEVBQVUsV0FBV0YsS0FBS0osR0FHM0JGLEVBQUVTLEtBQU8sQ0FFUkMsWUFBYSxDQUNaQyxFQUFLLFFBQ0xDLEVBQUssV0FDTEMsSUFBSyxlQUVOQyxXQUFXLEVBQ1hDLFNBQVUsWUFDVkMsWUFBYSxLQUdkaEIsRUFBRWlCLEdBQUdDLE9BQU8sQ0FFWEMsTUFBTyxTQUFTQyxFQUFPQyxHQUN0QixJQUFJQyxFQUVKLEdBQW9CLElBQWhCQyxLQUFLQyxTQUFnQkQsS0FBS0UsR0FBRyxZQUFjRixLQUFLRyxJQUFJLEtBQU9DLFNBQVNDLGNBSXhFLE1BQW9CLGlCQUFUUixHQUNWQyxFQUFzQixpQkFBUkEsRUFBb0JBLEVBQU1ELEVBQ2pDRyxLQUFLTSxLQUFLLFdBQ1pOLEtBQUtPLGtCQUNSUCxLQUFLTyxrQkFBa0JWLEVBQU9DLEdBQ3BCRSxLQUFLUSxtQkFDZlQs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LEdBRWpCNkQsRUFBTTFDLE1BQU1tRixHQUVXN0IsRUFBSXJELE9BQVM2QixHQUNqQm9CLEtBSXRCVyxFQUFFb0IscUJBMkdGVCxHQUFHLHdCQUF5QixXQUNUOUIsRUFBTStCLEtBQUssYUFJOUJFLFdBQVcsV0FDVixJQUFJckIsRUFBSVEsR0FBUyxHQUNqQnBCLEVBQU0xQyxNQUFNc0QsR0FDTUosS0FDaEIsS0FFWTlELEdBQVVDLEdBRVZxRCxFQUNLNEIsSUFBSSxjQUNKRSxHQUFHLGFBalB6QixTQUEyQlgsR0FDMUIsSUFBSThCLEVBQVNqRCxFQUFNTyxNQUNmSyxFQUFNWixFQUFNMUMsUUFDaEIsR0FBSWdDLEdBQVVBLEVBQU8zQixRQUFVMkIsRUFBTzNCLE9BQVNzRixFQUFPdEYsT0FBUyxDQUc5RCxJQURBeUQsR0FBUyxHQUNVLEVBQVpSLEVBQUlyRCxRQUFjMEIsRUFBTTJCLEVBQUlyRCxNQUFNLElBQ3hDcUQsRUFBSXJELFFBQ0wsR0FBa0IsSUFBZHFELEVBQUlyRCxNQUVQLEtBQU9xRCxFQUFJckQsTUFBUTRCLElBQW9CRixFQUFNMkIsRUFBSXJELFFBQ2hEcUQsRUFBSXJELFFBRU55QyxFQUFNMUMsTUFBTXNELEVBQUlyRCxNQUFNcUQsRUFBSXJELFdBQ3BCLENBQ0s2RCxHQUFTLEdBQXBCLElBQ0k4QixFQUFtQkQsRUFBT3ZDLE9BQU9FLEVBQUlyRCxPQUNyQ3FELEVBQUlyRCxNQUFROEIsSUFDWEosRUFBTTJCLEVBQUlyRCxRQUNicUQsRUFBSXJELFFBS0QwQixFQUFNMkIsRUFBSXJELE9BQU9kLEtBQUt5RyxJQUN4QnRDLEVBQUlyRCxTQUlQeUMsRUFBTTFDLE1BQU1zRCxFQUFJckQsTUFBTXFELEVBQUlyRCxPQUUzQmlELE1Bb05BWSIsImZpbGUiOiJqcXVlcnkubWFza2VkaW5wdXQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKGZhY3RvcnkpIHtcbiAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XG4gICAgICAgIC8vIEFNRC4gUmVnaXN0ZXIgYXMgYW4gYW5vbnltb3VzIG1vZHVsZS5cbiAgICAgICAgZGVmaW5lKFsnanF1ZXJ5J10sIGZhY3RvcnkpO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKSB7XG4gICAgICAgIC8vIE5vZGUvQ29tbW9uSlNcbiAgICAgICAgZmFjdG9yeShyZXF1aXJlKCdqcXVlcnknKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgLy8gQnJvd3NlciBnbG9iYWxzXG4gICAgICAgIGZhY3RvcnkoalF1ZXJ5KTtcbiAgICB9XG59KGZ1bmN0aW9uICgkKSB7XG5cbnZhciB1YSA9IG5hdmlnYXRvci51c2VyQWdlbnQsXG5cdGlQaG9uZSA9IC9pcGhvbmUvaS50ZXN0KHVhKSxcblx0Y2hyb21lID0gL2Nocm9tZS9pLnRlc3QodWEpLFxuXHRhbmRyb2lkID0gL2FuZHJvaWQvaS50ZXN0KHVhKSxcblx0Y2FyZXRUaW1lb3V0SWQ7XG5cbiQubWFzayA9IHtcblx0Ly9QcmVkZWZpbmVkIGNoYXJhY3RlciBkZWZpbml0aW9uc1xuXHRkZWZpbml0aW9uczoge1xuXHRcdCc5JzogXCJbMC05XVwiLFxuXHRcdCdhJzogXCJbQS1aYS16XVwiLFxuXHRcdCcqJzogXCJbQS1aYS16MC05XVwiXG5cdH0sXG5cdGF1dG9jbGVhcjogdHJ1ZSxcblx0ZGF0YU5hbWU6IFwicmF3TWFza0ZuXCIsXG5cdHBsYWNlaG9sZGVyOiAnXydcbn07XG5cbiQuZm4uZXh0ZW5kKHtcblx0Ly9IZWxwZXIgRnVuY3Rpb24gZm9yIENhcmV0IHBvc2l0aW9uaW5nXG5cdGNhcmV0OiBmdW5jdGlvbihiZWdpbiwgZW5kKSB7XG5cdFx0dmFyIHJhbmdlO1xuXG5cdFx0aWYgKHRoaXMubGVuZ3RoID09PSAwIHx8IHRoaXMuaXMoXCI6aGlkZGVuXCIpIHx8IHRoaXMuZ2V0KDApICE9PSBkb2N1bWVudC5hY3RpdmVFbGVtZW50KSB7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZiBiZWdpbiA9PSAnbnVtYmVyJykge1xuXHRcdFx0ZW5kID0gKHR5cGVvZiBlbmQgPT09ICdudW1iZXInKSA/IGVuZCA6IGJlZ2luO1xuXHRcdFx0cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHtcblx0XHRcdFx0aWYgKHRoaXMuc2V0U2VsZWN0aW9uUmFuZ2UpIHtcblx0XHRcdFx0XHR0aGlzLnNldFNlbGVjdGlvblJhbmdlKGJlZ2luLCBlbmQpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHRoaXMuY3JlYXRlVGV4dFJhbmdlKSB7XG5cdFx0XHRcdFx0cmFuZ2UgPSB0aGlzLmNyZWF0ZVRleHRSYW5nZSgpO1xuXHRcdFx0XHRcdHJhbmdlLmNvbGxhcHNlKHRydWUpO1xuXHRcdFx0XHRcdHJhbmdlLm1vdmVFbmQoJ2NoYXJhY3RlcicsIGVuZCk7XG5cdFx0XHRcdFx0cmFuZ2UubW92ZVN0YXJ0KCdjaGFyYWN0ZXInLCBiZWdpbik7XG5cdFx0XHRcdFx0cmFuZ2Uuc2VsZWN0KCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRpZiAodGhpc1swXS5zZXRTZWxlY3Rpb25SYW5nZSkge1xuXHRcdFx0XHRiZWdpbiA9IHRoaXNbMF0uc2VsZWN0aW9uU3RhcnQ7XG5cdFx0XHRcdGVuZCA9IHRoaXNbMF0uc2VsZWN0aW9uRW5kO1xuXHRcdFx0fSBlbHNlIGlmIChkb2N1bWVudC5zZWxlY3Rpb24gJiYgZG9jdW1lbnQuc2VsZWN0aW9uLmNyZWF0ZVJhbmdlKSB7XG5cdFx0XHRcdHJhbmdlID0gZG9jdW1lbnQuc2VsZWN0aW9uLmNyZWF0ZVJhbmdlKCk7XG5cdFx0XHRcdGJlZ2luID0gMCAtIHJhbmdlLmR1cGxpY2F0ZSgpLm1vdmVTdGFydCgnY2hhcmFjdGVyJywgLTEwMDAwMCk7XG5cdFx0XHRcdGVuZCA9IGJlZ2luICsgcmFuZ2UudGV4dC5sZW5ndGg7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4geyBiZWdpbjogYmVnaW4sIGVuZDogZW5kIH07XG5cdFx0fVxuXHR9LFxuXHR1bm1hc2s6IGZ1bmN0aW9uKCkge1xuXHRcdHJldHVybiB0aGlzLnRyaWdnZXIoXCJ1bm1hc2tcIik7XG5cdH0sXG5cdG1hc2s6IGZ1bmN0aW9uKG1hc2ssIHNldHRpbmdzKSB7XG5cdFx0dmFyIGlucHV0LFxuXHRcdFx0ZGVmcyxcblx0XHRcdHRlc3RzLFxuXHRcdFx0cGFydGlhbFBvc2l0aW9uLFxuXHRcdFx0Zmlyc3ROb25NYXNrUG9zLFxuICAgICAgICAgICAgbGFzdFJlcXVpcmVkTm9uTWFza1BvcyxcbiAgICAgICAgICAgIGxlbixcbiAgICAgICAgICAgIG9sZFZhbDtcblxuXHRcdGlmICghbWFzayAmJiB0aGlzLmxlbmd0aCA+IDApIHtcblx0XHRcdGlucHV0ID0gJCh0aGlzWzBdKTtcbiAgICAgICAgICAgIHZhciBmbiA9IGlucHV0LmRhdGEoJC5tYXNrLmRhdGFOYW1lKVxuXHRcdFx0cmV0dXJuIGZuP2ZuKCk6dW5kZWZpbmVkO1xuXHRcdH1cblxuXHRcdHNldHRpbmdzID0gJC5leHRlbmQoe1xuXHRcdFx0YXV0b2NsZWFyOiAkLm1hc2suYXV0b2NsZWFyLFxuXHRcdFx0cGxhY2Vob2xkZXI6ICQubWFzay5wbGFjZWhvbGRlciwgLy8gTG9hZCBkZWZhdWx0IHBsYWNlaG9sZGVyXG5cdFx0XHRjb21wbGV0ZWQ6IG51bGxcblx0XHR9LCBzZXR0aW5ncyk7XG5cblxuXHRcdGRlZnMgPSAkLm1hc2suZGVmaW5pdGlvbnM7XG5cdFx0dGVzdHMgPSBbXTtcblx0XHRwYXJ0aWFsUG9zaXRpb24gPSBsZW4gPSBtYXNrLmxlbmd0aDtcblx0XHRmaXJzdE5vbk1hc2tQb3MgPSBudWxsO1xuXG5cdFx0bWFzayA9IFN0cmluZyhtYXNrKTtcblxuXHRcdCQuZWFjaChtYXNrLnNwbGl0KFwiXCIpLCBmdW5jdGlvbihpLCBjKSB7XG5cdFx0XHRpZiAoYyA9PSAnPycpIHtcblx0XHRcdFx0bGVuLS07XG5cdFx0XHRcdHBhcnRpYWxQb3NpdGlvbiA9IGk7XG5cdFx0XHR9IGVsc2UgaWYgKGRlZnNbY10pIHtcblx0XHRcdFx0dGVzdHMucHVzaChuZXcgUmVnRXhwKGRlZnNbY10pKTtcblx0XHRcdFx0aWYgKGZpcnN0Tm9uTWFza1BvcyA9PT0gbnVsbCkge1xuXHRcdFx0XHRcdGZpcnN0Tm9uTWFza1BvcyA9IHRlc3RzLmxlbmd0aCAtIDE7XG5cdFx0XHRcdH1cbiAgICAgICAgICAgICAgICBpZihpIDwgcGFydGlhbFBvc2l0aW9uKXtcbiAgICAgICAgICAgICAgICAgICAgbGFzdFJlcXVpcmVkTm9uTWFza1BvcyA9IHRlc3RzLmxlbmd0aCAtIDE7XG4gICAgICAgICAgICAgICAgfVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGVzdHMucHVzaChudWxsKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHJldHVybiB0aGlzLnRyaWdnZXIoXCJ1bm1hc2tcIikuZWFjaChmdW5jdGlvbigpIHtcblx0XHRcdHZhciBpbnB1dCA9ICQodGhpcyksXG5cdFx0XHRcdGJ1ZmZlciA9ICQubWFwKFxuICAgIFx0XHRcdFx0bWFzay5zcGxpdChcIlwiKSxcbiAgICBcdFx0XHRcdGZ1bmN0aW9uKGMsIGkpIHtcbiAgICBcdFx0XHRcdFx0aWYgKGMgIT0gJz8nKSB7XG4gICAgXHRcdFx0XHRcdFx0cmV0dXJuIGRlZnNbY10gPyBnZXRQbGFjZWhvbGRlcihpKSA6IGM7XG4gICAgXHRcdFx0XHRcdH1cbiAgICBcdFx0XHRcdH0pLFxuXHRcdFx0XHRkZWZhdWx0QnVmZmVyID0gYnVmZmVyLmpvaW4oJycpLFxuXHRcdFx0XHRmb2N1c1RleHQgPSBpbnB1dC52YWwoKTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gdHJ5RmlyZUNvbXBsZXRlZCgpe1xuICAgICAgICAgICAgICAgIGlmICghc2V0dGluZ3MuY29tcGxldGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gZmlyc3ROb25NYXNrUG9zOyBpIDw9IGxhc3RSZXF1aXJlZE5vbk1hc2tQb3M7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGVzdHNbaV0gJiYgYnVmZmVyW2ldID09PSBnZXRQbGFjZWhvbGRlcihpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNldHRpbmdzLmNvbXBsZXRlZC5jYWxsKGlucHV0KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZ2V0UGxhY2Vob2xkZXIoaSl7XG4gICAgICAgICAgICAgICAgaWYoaSA8IHNldHRpbmdzLnBsYWNlaG9sZGVyLmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNldHRpbmdzLnBsYWNlaG9sZGVyLmNoYXJBdChpKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2V0dGluZ3MucGxhY2Vob2xkZXIuY2hhckF0KDApO1xuICAgICAgICAgICAgfVxuXG5cdFx0XHRmdW5jdGlvbiBzZWVrTmV4dChwb3MpIHtcblx0XHRcdFx0d2hpbGUgKCsrcG9zIDwgbGVuICYmICF0ZXN0c1twb3NdKTtcblx0XHRcdFx0cmV0dXJuIHBvcztcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gc2Vla1ByZXYocG9zKSB7XG5cdFx0XHRcdHdoaWxlICgtLXBvcyA+PSAwICYmICF0ZXN0c1twb3NdKTtcblx0XHRcdFx0cmV0dXJuIHBvcztcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gc2hpZnRMKGJlZ2luLGVuZCkge1xuXHRcdFx0XHR2YXIgaSxcblx0XHRcdFx0XHRqO1xuXG5cdFx0XHRcdGlmIChiZWdpbjwwKSB7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Zm9yIChpID0gYmVnaW4sIGogPSBzZWVrTmV4dChlbmQpOyBpIDwgbGVuOyBpKyspIHtcblx0XHRcdFx0XHRpZiAodGVzdHNbaV0pIHtcblx0XHRcdFx0XHRcdGlmIChqIDwgbGVuICYmIHRlc3RzW2ldLnRlc3QoYnVmZmVyW2pdKSkge1xuXHRcdFx0XHRcdFx0XHRidWZmZXJbaV0gPSBidWZmZXJbal07XG5cdFx0XHRcdFx0XHRcdGJ1ZmZlcltqXSA9IGdldFBsYWNlaG9sZGVyKGopO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGogPSBzZWVrTmV4dChqKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdFx0d3JpdGVCdWZmZXIoKTtcblx0XHRcdFx0aW5wdXQuY2FyZXQoTWF0aC5tYXgoZmlyc3ROb25NYXNrUG9zLCBiZWdpbikpO1xuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBzaGlmdFIocG9zKSB7XG5cdFx0XHRcdHZhciBpLFxuXHRcdFx0XHRcdGMsXG5cdFx0XHRcdFx0aixcblx0XHRcdFx0XHR0O1xuXG5cdFx0XHRcdGZvciAoaSA9IHBvcywgYyA9IGdldFBsYWNlaG9sZGVyKHBvcyk7IGkgPCBsZW47IGkrKykge1xuXHRcdFx0XHRcdGlmICh0ZXN0c1tpXSkge1xuXHRcdFx0XHRcdFx0aiA9IHNlZWtOZXh0KGkpO1xuXHRcdFx0XHRcdFx0dCA9IGJ1ZmZlcltpXTtcblx0XHRcdFx0XHRcdGJ1ZmZlcltpXSA9IGM7XG5cdFx0XHRcdFx0XHRpZiAoaiA8IGxlbiAmJiB0ZXN0c1tqXS50ZXN0KHQpKSB7XG5cdFx0XHRcdFx0XHRcdGMgPSB0O1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGFuZHJvaWRJbnB1dEV2ZW50KGUpIHtcblx0XHRcdFx0dmFyIGN1clZhbCA9IGlucHV0LnZhbCgpO1xuXHRcdFx0XHR2YXIgcG9zID0gaW5wdXQuY2FyZXQoKTtcblx0XHRcdFx0aWYgKG9sZFZhbCAmJiBvbGRWYWwubGVuZ3RoICYmIG9sZFZhbC5sZW5ndGggPiBjdXJWYWwubGVuZ3RoICkge1xuXHRcdFx0XHRcdC8vIGEgZGVsZXRpb24gb3IgYmFja3NwYWNlIGhhcHBlbmVkXG5cdFx0XHRcdFx0Y2hlY2tWYWwodHJ1ZSk7XG5cdFx0XHRcdFx0d2hpbGUgKHBvcy5iZWdpbiA+IDAgJiYgIXRlc3RzW3Bvcy5iZWdpbi0xXSlcblx0XHRcdFx0XHRcdHBvcy5iZWdpbi0tO1xuXHRcdFx0XHRcdGlmIChwb3MuYmVnaW4gPT09IDApXG5cdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0d2hpbGUgKHBvcy5iZWdpbiA8IGZpcnN0Tm9uTWFza1BvcyAmJiAhdGVzdHNbcG9zLmJlZ2luXSlcblx0XHRcdFx0XHRcdFx0cG9zLmJlZ2luKys7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlucHV0LmNhcmV0KHBvcy5iZWdpbixwb3MuYmVnaW4pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHZhciBwb3MyID0gY2hlY2tWYWwodHJ1ZSk7XG5cdFx0XHRcdFx0dmFyIGxhc3RFbnRlcmVkVmFsdWUgPSBjdXJWYWwuY2hhckF0KHBvcy5iZWdpbik7XG5cdFx0XHRcdFx0aWYgKHBvcy5iZWdpbiA8IGxlbil7XG5cdFx0XHRcdFx0XHRpZighdGVzdHNbcG9zLmJlZ2luXSl7XG5cdFx0XHRcdFx0XHRcdHBvcy5iZWdpbisrO1xuXHRcdFx0XHRcdFx0XHRpZih0ZXN0c1twb3MuYmVnaW5dLnRlc3QobGFzdEVudGVyZWRWYWx1ZSkpe1xuXHRcdFx0XHRcdFx0XHRcdHBvcy5iZWdpbisrO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9ZWxzZXtcblx0XHRcdFx0XHRcdFx0aWYodGVzdHNbcG9zLmJlZ2luXS50ZXN0KGxhc3RFbnRlcmVkVmFsdWUpKXtcblx0XHRcdFx0XHRcdFx0XHRwb3MuYmVnaW4rKztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpbnB1dC5jYXJldChwb3MuYmVnaW4scG9zLmJlZ2luKTtcblx0XHRcdFx0fVxuXHRcdFx0XHR0cnlGaXJlQ29tcGxldGVkKCk7XG5cdFx0XHR9XG5cblxuXHRcdFx0ZnVuY3Rpb24gYmx1ckV2ZW50KGUpIHtcbiAgICAgICAgICAgICAgICBjaGVja1ZhbCgpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbCgpICE9IGZvY3VzVGV4dClcbiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hhbmdlKCk7XG4gICAgICAgICAgICB9XG5cblx0XHRcdGZ1bmN0aW9uIGtleWRvd25FdmVudChlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGlucHV0LnByb3AoXCJyZWFkb25seVwiKSl7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cblx0XHRcdFx0dmFyIGsgPSBlLndoaWNoIHx8IGUua2V5Q29kZSxcblx0XHRcdFx0XHRwb3MsXG5cdFx0XHRcdFx0YmVnaW4sXG5cdFx0XHRcdFx0ZW5kO1xuICAgICAgICAgICAgICAgICAgICBvbGRWYWwgPSBpbnB1dC52YWwoKTtcblx0XHRcdFx0Ly9iYWNrc3BhY2UsIGRlbGV0ZSwgYW5kIGVzY2FwZSBnZXQgc3BlY2lhbCB0cmVhdG1lbnRcblx0XHRcdFx0aWYgKGsgPT09IDggfHwgayA9PT0gNDYgfHwgKGlQaG9uZSAmJiBrID09PSAxMjcpKSB7XG5cdFx0XHRcdFx0cG9zID0gaW5wdXQuY2FyZXQoKTtcblx0XHRcdFx0XHRiZWdpbiA9IHBvcy5iZWdpbjtcblx0XHRcdFx0XHRlbmQgPSBwb3MuZW5kO1xuXG5cdFx0XHRcdFx0aWYgKGVuZCAtIGJlZ2luID09PSAwKSB7XG5cdFx0XHRcdFx0XHRiZWdpbj1rIT09NDY/c2Vla1ByZXYoYmVnaW4pOihlbmQ9c2Vla05leHQoYmVnaW4tMSkpO1xuXHRcdFx0XHRcdFx0ZW5kPWs9PT00Nj9zZWVrTmV4dChlbmQpOmVuZDtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0Y2xlYXJCdWZmZXIoYmVnaW4sIGVuZCk7XG5cdFx0XHRcdFx0c2hpZnRMKGJlZ2luLCBlbmQgLSAxKTtcblxuXHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0fSBlbHNlIGlmKCBrID09PSAxMyApIHsgLy8gZW50ZXJcblx0XHRcdFx0XHRibHVyRXZlbnQuY2FsbCh0aGlzLCBlKTtcblx0XHRcdFx0fSBlbHNlIGlmIChrID09PSAyNykgeyAvLyBlc2NhcGVcblx0XHRcdFx0XHRpbnB1dC52YWwoZm9jdXNUZXh0KTtcblx0XHRcdFx0XHRpbnB1dC5jYXJldCgwLCBjaGVja1ZhbCgpKTtcblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24ga2V5cHJlc3NFdmVudChlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGlucHV0LnByb3AoXCJyZWFkb25seVwiKSl7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cblx0XHRcdFx0dmFyIGsgPSBlLndoaWNoIHx8IGUua2V5Q29kZSxcblx0XHRcdFx0XHRwb3MgPSBpbnB1dC5jYXJldCgpLFxuXHRcdFx0XHRcdHAsXG5cdFx0XHRcdFx0Yyxcblx0XHRcdFx0XHRuZXh0O1xuXG5cdFx0XHRcdGlmIChlLmN0cmxLZXkgfHwgZS5hbHRLZXkgfHwgZS5tZXRhS2V5IHx8IGsgPCAzMikgey8vSWdub3JlXG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCBrICYmIGsgIT09IDEzICkge1xuXHRcdFx0XHRcdGlmIChwb3MuZW5kIC0gcG9zLmJlZ2luICE9PSAwKXtcblx0XHRcdFx0XHRcdGNsZWFyQnVmZmVyKHBvcy5iZWdpbiwgcG9zLmVuZCk7XG5cdFx0XHRcdFx0XHRzaGlmdEwocG9zLmJlZ2luLCBwb3MuZW5kLTEpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHAgPSBzZWVrTmV4dChwb3MuYmVnaW4gLSAxKTtcblx0XHRcdFx0XHRpZiAocCA8IGxlbikge1xuXHRcdFx0XHRcdFx0YyA9IFN0cmluZy5mcm9tQ2hhckNvZGUoayk7XG5cdFx0XHRcdFx0XHRpZiAodGVzdHNbcF0udGVzdChjKSkge1xuXHRcdFx0XHRcdFx0XHRzaGlmdFIocCk7XG5cblx0XHRcdFx0XHRcdFx0YnVmZmVyW3BdID0gYztcblx0XHRcdFx0XHRcdFx0d3JpdGVCdWZmZXIoKTtcblx0XHRcdFx0XHRcdFx0bmV4dCA9IHNlZWtOZXh0KHApO1xuXG5cdFx0XHRcdFx0XHRcdGlmKGFuZHJvaWQpe1xuXHRcdFx0XHRcdFx0XHRcdC8vUGF0aCBmb3IgQ1NQIFZpb2xhdGlvbiBvbiBGaXJlRm94IE9TIDEuMVxuXHRcdFx0XHRcdFx0XHRcdHZhciBwcm94eSA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0JC5wcm94eSgkLmZuLmNhcmV0LGlucHV0LG5leHQpKCk7XG5cdFx0XHRcdFx0XHRcdFx0fTtcblxuXHRcdFx0XHRcdFx0XHRcdHNldFRpbWVvdXQocHJveHksMCk7XG5cdFx0XHRcdFx0XHRcdH1lbHNle1xuXHRcdFx0XHRcdFx0XHRcdGlucHV0LmNhcmV0KG5leHQpO1xuXHRcdFx0XHRcdFx0XHR9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYocG9zLmJlZ2luIDw9IGxhc3RSZXF1aXJlZE5vbk1hc2tQb3Mpe1xuXHRcdCAgICAgICAgICAgICAgICAgICAgICAgICB0cnlGaXJlQ29tcGxldGVkKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGNsZWFyQnVmZmVyKHN0YXJ0LCBlbmQpIHtcblx0XHRcdFx0dmFyIGk7XG5cdFx0XHRcdGZvciAoaSA9IHN0YXJ0OyBpIDwgZW5kICYmIGkgPCBsZW47IGkrKykge1xuXHRcdFx0XHRcdGlmICh0ZXN0c1tpXSkge1xuXHRcdFx0XHRcdFx0YnVmZmVyW2ldID0gZ2V0UGxhY2Vob2xkZXIoaSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIHdyaXRlQnVmZmVyKCkgeyBpbnB1dC52YWwoYnVmZmVyLmpvaW4oJycpKTsgfVxuXG5cdFx0XHRmdW5jdGlvbiBjaGVja1ZhbChhbGxvdykge1xuXHRcdFx0XHQvL3RyeSB0byBwbGFjZSBjaGFyYWN0ZXJzIHdoZXJlIHRoZXkgYmVsb25nXG5cdFx0XHRcdHZhciB0ZXN0ID0gaW5wdXQudmFsKCksXG5cdFx0XHRcdFx0bGFzdE1hdGNoID0gLTEsXG5cdFx0XHRcdFx0aSxcblx0XHRcdFx0XHRjLFxuXHRcdFx0XHRcdHBvcztcblxuXHRcdFx0XHRmb3IgKGkgPSAwLCBwb3MgPSAwOyBpIDwgbGVuOyBpKyspIHtcblx0XHRcdFx0XHRpZiAodGVzdHNbaV0pIHtcblx0XHRcdFx0XHRcdGJ1ZmZlcltpXSA9IGdldFBsYWNlaG9sZGVyKGkpO1xuXHRcdFx0XHRcdFx0d2hpbGUgKHBvcysrIDwgdGVzdC5sZW5ndGgpIHtcblx0XHRcdFx0XHRcdFx0YyA9IHRlc3QuY2hhckF0KHBvcyAtIDEpO1xuXHRcdFx0XHRcdFx0XHRpZiAodGVzdHNbaV0udGVzdChjKSkge1xuXHRcdFx0XHRcdFx0XHRcdGJ1ZmZlcltpXSA9IGM7XG5cdFx0XHRcdFx0XHRcdFx0bGFzdE1hdGNoID0gaTtcblx0XHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0aWYgKHBvcyA+IHRlc3QubGVuZ3RoKSB7XG5cdFx0XHRcdFx0XHRcdGNsZWFyQnVmZmVyKGkgKyAxLCBsZW4pO1xuXHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJ1ZmZlcltpXSA9PT0gdGVzdC5jaGFyQXQocG9zKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvcysrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoIGkgPCBwYXJ0aWFsUG9zaXRpb24pe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RNYXRjaCA9IGk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHRcdGlmIChhbGxvdykge1xuXHRcdFx0XHRcdHdyaXRlQnVmZmVyKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAobGFzdE1hdGNoICsgMSA8IHBhcnRpYWxQb3NpdGlvbikge1xuXHRcdFx0XHRcdGlmIChzZXR0aW5ncy5hdXRvY2xlYXIgfHwgYnVmZmVyLmpvaW4oJycpID09PSBkZWZhdWx0QnVmZmVyKSB7XG5cdFx0XHRcdFx0XHQvLyBJbnZhbGlkIHZhbHVlLiBSZW1vdmUgaXQgYW5kIHJlcGxhY2UgaXQgd2l0aCB0aGVcblx0XHRcdFx0XHRcdC8vIG1hc2ssIHdoaWNoIGlzIHRoZSBkZWZhdWx0IGJlaGF2aW9yLlxuXHRcdFx0XHRcdFx0aWYoaW5wdXQudmFsKCkpIGlucHV0LnZhbChcIlwiKTtcblx0XHRcdFx0XHRcdGNsZWFyQnVmZmVyKDAsIGxlbik7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdC8vIEludmFsaWQgdmFsdWUsIGJ1dCB3ZSBvcHQgdG8gc2hvdyB0aGUgdmFsdWUgdG8gdGhlXG5cdFx0XHRcdFx0XHQvLyB1c2VyIGFuZCBhbGxvdyB0aGVtIHRvIGNvcnJlY3QgdGhlaXIgbWlzdGFrZS5cblx0XHRcdFx0XHRcdHdyaXRlQnVmZmVyKCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHdyaXRlQnVmZmVyKCk7XG5cdFx0XHRcdFx0aW5wdXQudmFsKGlucHV0LnZhbCgpLnN1YnN0cmluZygwLCBsYXN0TWF0Y2ggKyAxKSk7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIChwYXJ0aWFsUG9zaXRpb24gPyBpIDogZmlyc3ROb25NYXNrUG9zKTtcblx0XHRcdH1cblxuXHRcdFx0aW5wdXQuZGF0YSgkLm1hc2suZGF0YU5hbWUsZnVuY3Rpb24oKXtcblx0XHRcdFx0cmV0dXJuICQubWFwKGJ1ZmZlciwgZnVuY3Rpb24oYywgaSkge1xuXHRcdFx0XHRcdHJldHVybiB0ZXN0c1tpXSYmYyE9Z2V0UGxhY2Vob2xkZXIoaSkgPyBjIDogbnVsbDtcblx0XHRcdFx0fSkuam9pbignJyk7XG5cdFx0XHR9KTtcblxuXG5cdFx0XHRpbnB1dFxuXHRcdFx0XHQub25lKFwidW5tYXNrXCIsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdGlucHV0XG5cdFx0XHRcdFx0XHQub2ZmKFwiLm1hc2tcIilcblx0XHRcdFx0XHRcdC5yZW1vdmVEYXRhKCQubWFzay5kYXRhTmFtZSk7XG5cdFx0XHRcdH0pXG5cdFx0XHRcdC5vbihcImZvY3VzLm1hc2tcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpbnB1dC5wcm9wKFwicmVhZG9ubHlcIikpe1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG5cblx0XHRcdFx0XHRjbGVhclRpbWVvdXQoY2FyZXRUaW1lb3V0SWQpO1xuXHRcdFx0XHRcdHZhciBwb3M7XG5cblx0XHRcdFx0XHRmb2N1c1RleHQgPSBpbnB1dC52YWwoKTtcblxuXHRcdFx0XHRcdHBvcyA9IGNoZWNrVmFsKCk7XG5cblx0XHRcdFx0XHRjYXJldFRpbWVvdXRJZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGlucHV0LmdldCgwKSAhPT0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXHRcdFx0XHRcdFx0d3JpdGVCdWZmZXIoKTtcblx0XHRcdFx0XHRcdGlmIChwb3MgPT0gbWFzay5yZXBsYWNlKFwiP1wiLFwiXCIpLmxlbmd0aCkge1xuXHRcdFx0XHRcdFx0XHRpbnB1dC5jYXJldCgwLCBwb3MpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0aW5wdXQuY2FyZXQocG9zKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9LCAxMCk7XG5cdFx0XHRcdH0pXG5cdFx0XHRcdC5vbihcImJsdXIubWFza1wiLCBibHVyRXZlbnQpXG5cdFx0XHRcdC5vbihcImtleWRvd24ubWFza1wiLCBrZXlkb3duRXZlbnQpXG5cdFx0XHRcdC5vbihcImtleXByZXNzLm1hc2tcIiwga2V5cHJlc3NFdmVudClcblx0XHRcdFx0Lm9uKFwiaW5wdXQubWFzayBwYXN0ZS5tYXNrXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXQucHJvcChcInJlYWRvbmx5XCIpKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG5cdFx0XHRcdFx0c2V0VGltZW91dChmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdHZhciBwb3M9Y2hlY2tWYWwodHJ1ZSk7XG5cdFx0XHRcdFx0XHRpbnB1dC5jYXJldChwb3MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJ5RmlyZUNvbXBsZXRlZCgpO1xuXHRcdFx0XHRcdH0sIDApO1xuXHRcdFx0XHR9KTtcbiAgICAgICAgICAgICAgICBpZiAoY2hyb21lICYmIGFuZHJvaWQpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBpbnB1dFxuICAgICAgICAgICAgICAgICAgICAgICAgLm9mZignaW5wdXQubWFzaycpXG4gICAgICAgICAgICAgICAgICAgICAgICAub24oJ2lucHV0Lm1hc2snLCBhbmRyb2lkSW5wdXRFdmVudCk7XG4gICAgICAgICAgICAgICAgfVxuXHRcdFx0XHRjaGVja1ZhbCgpOyAvL1BlcmZvcm0gaW5pdGlhbCBjaGVjayBmb3IgZXhpc3RpbmcgdmFsdWVzXG5cdFx0fSk7XG5cdH1cbn0pO1xufSkpOyJdfQ==
